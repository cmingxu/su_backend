#= require jquery


building = angular.module "building", ['ngResource', 'ui.router', 'templates']

building.config ['$httpProvider', ($httpProvider) ->
  $httpProvider.defaults.headers.common['Content-Type'] = 'application/json'
  $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content')
]

building.config ['$stateProvider', '$urlRouterProvider', ($stateProvider, $urlRouterProvider) ->

  $urlRouterProvider.otherwise '/local'


  $stateProvider.state 'local',
    url: "/local"
    controller: 'Local'
    templateUrl: '/assets/local.html'

  $stateProvider.state 'system',
    url: "/system"
    controller: 'System'
    templateUrl: '<%= asset_path 'system.html' %>'

  $stateProvider.state 'remote',
    url: "/remote"
    controller: 'Remote'
    templateUrl: '<%= asset_path 'remote.html' %>'
]


building.factory "Entity", ($resource) ->
  $resource("/api/entities/:id", {id: '@id'}, {
    index:
      method: 'GET'
      isArray: true
  })

building.controller "Local", ['$scope', ($scope) ->
  console.log('local')
]

building.controller "Remote", ['$scope', ($scope) ->
  console.log('remote')
]

building.controller "System", ['$scope', '$http', '$interval', "Entity", ($scope, $http, $interval, Entity) ->
  $scope.current_model = {}
  $scope.system_models = {}
  Entity.index (data) ->
    $scope.system_models = data
    console.log data

]

building.controller "Main", ['$scope', '$http', '$interval', "Entity", ($scope, $http, $interval, Entity) ->
  $scope.current_model = {}

  $scope.bridge = (action, param) ->
    console.log 'bridge' + action
    window.location.href = "skp:" + action + "@" + param

  $scope.current_model_name_change = () ->
    $scope.bridge "current_model_name_change", $scope.current_model.name
]

